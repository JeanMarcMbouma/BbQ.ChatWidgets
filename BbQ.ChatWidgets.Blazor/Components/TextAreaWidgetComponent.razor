@using BbQ.ChatWidgets.Models
@using Microsoft.AspNetCore.Components

<div class="bbq-widget bbq-textarea-widget">
    <label class="bbq-textarea-label">@Widget?.Label</label>
    <textarea 
        class="bbq-textarea" 
        placeholder="@(Widget?.Placeholder ?? string.Empty)"
        maxlength="@(Widget?.MaxLength ?? int.MaxValue)"
        rows="@(Widget?.Rows ?? 4)"
        @bind="textValue"
        @bind:event="oninput"
        @onchange="HandleChange"></textarea>
</div>

@code {
    [Parameter]
    public TextAreaWidget? Widget { get; set; }

    [Parameter]
    public EventCallback<(string Action, object? Payload)> OnAction { get; set; }

    private string textValue = string.Empty;

    private async Task HandleChange(ChangeEventArgs e)
    {
        textValue = e.Value?.ToString() ?? string.Empty;
        if (Widget != null)
        {
            var payload = new { value = textValue };
            await OnAction.InvokeAsync((Widget.Action, payload));
        }
    }
}
